<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">


    <title>Photo Editor</title>
    <style type="text/css">
      .bg-header{
        background-color: rgb(0, 204, 255);
      }
      .bg-nav{
        background-color: rgb(184, 187, 187);
        box-shadow: 0px 0px 13px 0px rgba(0, 0, 0, 0.173);
      }
      .icn {
        font-size: 30px;
        color: #016fff;
        padding: 20px 10px 20px 10px;
      }
      .content-1 {
        padding-left: 0;
        padding-right: 0;
        margin: 0 auto;
        display: block;
        float: none;
        width: 100%;
        height: 100%;
        padding-top: 10px;
      }
      .brd {
        border-right-style: solid;
        border-bottom-style: none;
        border-color: #016fff;
      }
      @media screen and (max-width: 992px){
        .brd {
          border-right-style: none;
          border-bottom-style: solid;
          border-color: #016fff;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container-fluid bg-header">
        <div class="text-center">
          <a href="index.html"><img src="" alt=""></a>
        </div>
      </div>
      <div class="container-fluid bg-nav">
        <div class="col-md-12 text-center">
          <div class="row">
            <div class="col-md-2 brd" >
              <div class="row">
                <div class="col-md-6 col-6">
                  <button type="button" id="camera" class="btn btn-link" data-toggle="modal" data-target="#exampleModal">
                    <i class="material-icons icn">add_a_photo</i>
                  </button>
                  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="exampleModalLabel">Prendre une photo</h5>
                          <button type="button" class="close" id="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                          </button>
                        </div>
                        <div class="modal-body">
                          <video id="video" autoplay class="content-1"></video>
                        </div>
                        <div class="modal-footer">
                          <button type="button" id="close1" class="btn btn-secondary" data-dismiss="modal">Close</button>
                          <button type="button" id="copie" class="btn btn-primary" data-dismiss="modal">Copier image courante</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6 col-6">
                  <label for="imageUpload" class="btn btn-link" style="cursor: pointer;">
                    <i class="material-icons icn">add_photo_alternate</i>
                  </label>
                  <input type="file" id="imageUpload" class="form-control" accept="image/*" name="photo" style="display: none">
                </div>
              </div>
            </div>
            <div class="col-md-10">
              <div class="row">
                <div class="col-md-1 col-4">
                  <div class="dropdown">
                    <button type="button" class="btn btn-link" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="material-icons icn">grain</i>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <div class="form-group">
                        <label class="col-lg-2 control-label">Grayscale</label>
                        <div class="col-lg-10">
                          <input type="range" id="Grayscale" class="slider custom-range" min="0" max="100" value="0">
                          <span class="slider_label"></span></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-1 col-4">
                  <div class="dropdown">
                    <button type="button" class="btn btn-link" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="material-icons icn">blur_linear</i>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <div class="form-group">
                        <label class="col-lg-2 control-label">Blur</label>
                        <div class="col-lg-10">
                          <input type="range" id="Blur" class="slider custom-range" min="0" max="100" value="0">
                          <span class="slider_label"></span></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-1 col-4">
                  <div class="dropdown">
                    <button type="button" class="btn btn-link" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="material-icons icn">brightness_3</i>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <div class="form-group">
                        <label class="col-lg-2 control-label">Brightness</label>
                        <div class="col-lg-10">
                          <input type="range" id="Brightness" class="slider custom-range" min="0" max="100" value="0">
                          <span class="slider_label"></span></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-1 col-4">
                  <div class="dropdown">
                    <button type="button" class="btn btn-link" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="material-icons icn">filter_b_and_w</i>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <div class="form-group">
                        <label class="col-lg-2 control-label">Contrast</label>
                        <div class="col-lg-10">
                          <input type="range" id="Contrast" class="slider custom-range" min="0" max="100" value="0">
                          <span class="slider_label"></span></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-1 col-4">
                  <div class="dropdown">
                    <button type="button" class="btn btn-link" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="material-icons icn">color_lens</i>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <div class="form-group">
                        <label class="col-lg-2 control-label">Hue_Rotate</label>
                        <div class="col-lg-9">
                          <input type="range" id="Hue_Rotate" class="slider custom-range" min="0" max="100" value="0">
                          <span class="slider_label"></span></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-1 col-4">
                  <div class="dropdown">
                    <button type="button" class="btn btn-link" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="material-icons icn">opacity</i>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <div class="form-group">
                        <label class="col-lg-2 control-label">Opacity</label>
                        <div class="col-lg-10">
                          <input type="range" id="Opacity" class="slider custom-range" min="0" max="100" value="100">
                          <span class="slider_label"></span></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-1 col-4">
                  <div class="dropdown">
                    <button type="button" class="btn btn-link" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="material-icons icn">invert_colors</i>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <div class="form-group">
                        <label class="col-lg-2 control-label">Invert</label>
                        <div class="col-lg-10">
                          <input type="range" id="Invert" class="slider custom-range" min="0" max="100" value="100">
                          <span class="slider_label"></span></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-1 col-4">
                  <div class="dropdown">
                    <button type="button" class="btn btn-link" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="fas fa-temperature-low icn"></i>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <div class="form-group">
                        <label class="col-lg-2 control-label">Saturate</label>
                        <div class="col-lg-10">
                          <input type="range" id="Saturate" class="slider custom-range" min="0" max="100" value="0">
                          <span class="slider_label"></span></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-1 col-4">
                  <div class="dropdown">
                    <button type="button" class="btn btn-link" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="fas fa-filter icn"></i>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                      <div class="form-group">
                        <label class="col-lg-2 control-label">Sepia</label>
                        <div class="col-lg-10">
                          <input type="range" id="Sepia" class="slider custom-range" min="0" max="100" value="0">
                          <span class="slider_label"></span></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-1 col-4">
                  <div class="dropdown">
                    <button type="button" class="btn btn-link" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="material-icons icn">crop</i>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="width: 250px">
                      <div class="form-group">
                        <label class="col-lg-2 control-label">DrawImage</label>
                        <div class="col-lg-10">
                          <div class="row">
                            <div class="col-lg-6">
                              <div class="form-group">
                                <label for="x">X :</label>
                                <input type="number" class="form-control" id="x" placeholder="X">
                              </div>
                            </div>
                            <div class="col-lg-6">
                              <div class="form-group">
                                <label for="Y">Y:</label>
                                <input type="number" class="form-control" id="Y" placeholder="Y">
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-lg-6">
                              <div class="form-group">
                                <label for="Width">Width :</label>
                                <input type="number" class="form-control" id="Width" placeholder="Width">
                              </div>
                            </div>
                            <div class="col-lg-6">
                              <div class="form-group">
                                <label for="Height">Height:</label>
                                <input type="number" class="form-control" id="Height" placeholder="Height">
                              </div>
                            </div>
                          </div>
                          <div class="row">
                            <div class="col-lg-12"> 
                              <button type="button" class="btn btn-warning">Ok</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-1 col-4">
                  <div class="text-center" style="padding : 20px">
                    <button type="button" class="btn btn-warning btn-sx" id="reset">
                      Reset
                    </button>
                  </div>
                </div>
                <div class="col-md-1 col-4">
                  <div class="text-center" style="padding : 20px">
                    <a href="#" class="btn btn-success btn-sx" id="save">
                      Save
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <canvas id="canvasEditor" class="content-1 text-center" width="1000" height="1000">
            Désolé, votre navigateur ne supporte pas les &lt;canvas&gt; élément.
          </canvas>
        </div>
        <div class="col-md-6">
          <canvas id="origine" class="content-1" width="1000" height="1000">
            Désolé, votre navigateur ne supporte pas les &lt;canvas&gt; élément.
          </canvas>
        </div>
      </div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script>
      $(function(){

        const canvas = document.querySelector('#canvasEditor')
        const ctx = canvas.getContext('2d')

        const canvas1 = document.querySelector('#origine')
        const ctx1 = canvas1.getContext('2d')

        const video = document.querySelector('#video')

        $('.slider').on('input change', function(){
          $(this).next($('.slider_label')).html(this.value);
        });
        $('.slider_label').each(function(){
          const value = $(this).prev().attr('value');
          $(this).html(value);
        });
 
        function activeCamera() {
          navigator.mediaDevices.getUserMedia({video: true}).then(function(stream){
            video.srcObject = stream
          })
        }
        $( "#camera" ).on( "click", activeCamera );  

        function desactiveCamera() {
          let stream = video.srcObject;
          let tracks = stream.getTracks();

          tracks.forEach(function(track) {
            track.stop();
          });

          video.srcObject = null;
        }
        $( "#close,#close1" ).on( "click", desactiveCamera );

        function copier(e) {
          ctx1.clearRect(0, 0, canvas1.width, canvas1.height);
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          ctx.drawImage(video, video.width, video.height)
          ctx1.drawImage(video, video.width, video.height)
          desactiveCamera()
        }
        $( "#copie" ).on( "click", copier );

        function handleImage(e){
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx1.clearRect(0, 0, canvas1.width, canvas1.height);
          const reader = new FileReader();
          reader.onload = function(event){
              const imgNew = new Image();
              imgNew.onload = function(){
                canvas.width = imgNew.width;
                canvas.height = imgNew.height;
                ctx.drawImage(imgNew,0,0);

                canvas1.width = imgNew.width;
                canvas1.height = imgNew.height;
                ctx1.drawImage(imgNew,0,0);
              }
              imgNew.src = event.target.result;
          }
          reader.readAsDataURL(e.target.files[0]);  
        }
        $( "#imageUpload" ).on('change', handleImage);

        function allFilter(){

          var filter =  'grayscale('+ $( "#Grayscale" ).val()+'%) ' +
                        'blur('+ $("#Blur").val()+'px) ' + 'brightness('+ $("#Brightness").val()+'%) ' + 'contrast('+ $("#Contrast").val()+'%) ' +
                        'hue-rotate('+ $("#Hue_Rotate").val()+'deg) ' + 'opacity('+ $("#Opacity").val()+'%) ' + 'invert('+ $("#Invert").val()+'%) ' +
                        'saturate('+ $("#Saturate").val()+'%) ' + 'sepia('+ $("#Sepia").val()+'%) '

          
          const img = new Image()
          img.src = canvas.toDataURL("image/jpeg")
          img.onload = function() {
            ctx1.save()
            ctx1.filter = filter
            ctx1.drawImage(img, 0, 0)
            ctx1.restore()
          }
        }
        $('input[type="range"]').on('change', allFilter);


        function save() {
          this.href = canvas1.toDataURL();
          this.download = 'editorImage.png';
        }
        $( "#save" ).on('click', save);
      })
    </script>
  </body>
</html>